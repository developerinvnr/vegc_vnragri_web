<?php include '../config.php';date_default_timezone_set('asia/calcutta');if($_REQUEST['userid']!='' && $_REQUEST['value'] == 'InsMyTrv'){  //userid, date, description, purpose, remark, value=InsMyTrv  //----------------------------------------------------------------  //----------------------------------------------------------------	  //User List with Reporting    $uu1=0; $uu2=0; $uu3=0; $uu4=0; $uu5=0; $uu6=0;   $Rep=$_REQUEST['userid'];    $array_u1=array(); $array_u2=array(); $array_u3=array(); $array_u4=array(); $array_u5=array(); $array_u6=array();  $su1=mysql_query("select * from users where uStatus='A' and uReporting=".$Rep); $row1=mysql_num_rows($su1);  if($row1>0)  {   while($ru1=mysql_fetch_assoc($su1)){ $array_u1[]=$ru1['uId']; }    $uu1 = implode(',', $array_u1);     $su2=mysql_query("select * from users where uStatus='A' and uReporting in (".$uu1.") "); $row2=mysql_num_rows($su2);   if($row2>0)   {    while($ru2=mysql_fetch_assoc($su2)){ $array_u2[]=$ru2['uId']; }     $uu2 = implode(',', $array_u2);       $su3=mysql_query("select * from users where uStatus='A' and uReporting in (".$uu2.") "); $row3=mysql_num_rows($su3);	if($row3>0)	{     while($ru3=mysql_fetch_assoc($su3)){ $array_u3[]=$ru3['uId']; }      $uu3 = implode(',', $array_u3);        $su4=mysql_query("select * from users where uStatus='A' and uReporting in (".$uu3.") "); $row4=mysql_num_rows($su4);	 if($row4>0)	 {      while($ru4=mysql_fetch_assoc($su4)){ $array_u4[]=$ru4['uId']; }       $uu4 = implode(',', $array_u4);	  	  $su5=mysql_query("select * from users where uStatus='A' and uReporting in (".$uu4.") "); $row5=mysql_num_rows($su5);	  if($row5>0)	  {       while($ru5=mysql_fetch_assoc($su5)){ $array_u5[]=$ru5['uId']; }        $uu5 = implode(',', $array_u5);	   	   $su6=mysql_query("select * from users where uStatus='A' and uReporting in (".$uu5.") "); $row6=mysql_num_rows($su6);	   if($row6>0)	   {        while($ru6=mysql_fetch_assoc($su6)){ $array_u6[]=$ru6['uId']; }         $uu5 = implode(',', $array_u6);	   } 	   	  } 	  	 } 	}    }	   }	  $uesrList=$uu1.','.$uu2.','.$uu3.','.$uu4.','.$uu5.','.$uu6.','.$_REQUEST['userid'];     if($_REQUEST['date']!='')  {   $d=date("d",strtotime($_REQUEST['date'])); $d=intval($d);    $m=date("m",strtotime($_REQUEST['date'])); $m=intval($m);   $y=date("Y",strtotime($_REQUEST['date']));   $sql=mysql_query("select * from tourplan where UserId=".$_REQUEST['userid']." AND Date='".date("Y-m-d",strtotime($_REQUEST['date']))."'");   $row=mysql_fetch_assoc($sql);   if($row==0){ $sInsUp=mysql_query("insert into tourplan(UserId, Month, Year, Date, Description, Purpose, Remark) values(".$_REQUEST['userid'].", ".$m.", ".$y.", '".date("Y-m-d",strtotime($_REQUEST['date']))."', '".addslashes($_REQUEST['description'])."', '".addslashes($_REQUEST['purpose'])."', '".addslashes($_REQUEST['remark'])."')"); }   else{ $sInsUp=mysql_query("update tourplan set Description='".addslashes($_REQUEST['description'])."', Purpose='".addslashes($_REQUEST['purpose'])."', Remark='".addslashes($_REQUEST['remark'])."' where UserId=".$_REQUEST['userid']." AND Date='".date("Y-m-d",strtotime($_REQUEST['date']))."'"); }   if($sInsUp){ echo json_encode(array("code"=>"300", "return"=>"success") ); }  }  else  {   echo json_encode(array("return"=>"date missing") );  }  }elseif($_REQUEST['userid']!='' && $_REQUEST['value'] == 'MyTrvList'){  //userid, month, year, value=MyTrvList  if($_REQUEST['month']>0 AND $_REQUEST['year']>0)  {   $sql=mysql_query("select * from tourplan where UserId=".$_REQUEST['userid']." AND Month=".$_REQUEST['month']." AND Year=".$_REQUEST['year'].""); $row=mysql_num_rows($sql); $Tarray = array();   if($row>0)   {     while($res=mysql_fetch_assoc($sql)){ $Tarray[]=$res; }	 echo json_encode(array( "MyTour_list" => $Tarray) );    }   else   {    echo json_encode(array("return"=>"no data found") );   }  }  }elseif($_REQUEST['userid']!='' && $_REQUEST['value'] == 'MyTeam'){  //userid, value=MyTeam  $sql=mysql_query("select state_id from user_location where uid=".$_REQUEST['userid']." AND sts='A' AND state_id>0 group by state_id");  $row=mysql_num_rows($sql);  if($row>0)  {     while($res=mysql_fetch_array($sql)){ $array_s[]=$res['state_id']; }    $ss = implode(',', $array_s);     }    // $sqlu=mysql_query("select u.uid,u.uName from user_location ul inner join users u on ul.uid=u.uid where ul.state_id in (".$ss.") and (u.uPost='1' OR u.uPost='5' OR u.uPost='6' OR u.uPost='7' OR u.uPost='8' OR u.uPost='10') and uStatus='A' and u.uid!=".$_REQUEST['userid']." and ul.sts='A' group by u.uName order by u.uName"); $Uarray = array(); $rowu=mysql_num_rows($sqlu);     $sqlu=mysql_query("select u.uid,u.uName from users u where u.uid in (".$uesrList.") and uStatus='A' and u.uid!=".$_REQUEST['userid']." group by u.uName order by u.uName"); $Uarray = array(); $rowu=mysql_num_rows($sqlu);  if($rowu>0)  {   while($resu=mysql_fetch_assoc($sqlu)){ $Uarray[]=$resu; }   echo json_encode(array( "MyTeam_list" => $Uarray) );  }  else  {   echo json_encode(array("return"=>"no data found") );  }  }elseif($_REQUEST['userid']!='' && $_REQUEST['value'] == 'MyTeamTrvList'){ //userid, TeamId, month, year, value=MyTeamTrvList if($_REQUEST['month']>0 AND $_REQUEST['year']>0) {  $sql=mysql_query("select * from tourplan where UserId=".$_REQUEST['TeamId']." AND Month=".$_REQUEST['month']." AND Year=".$_REQUEST['year'].""); $row=mysql_num_rows($sql); $Tarray = array();  if($row>0)  {    while($res=mysql_fetch_assoc($sql)){ $Tarray[]=$res; }	echo json_encode(array( "MyTeamTour_list" => $Tarray) );   }  else  {   echo json_encode(array("return"=>"no data found") );  } } }else{ echo json_encode(array("return"=>"value missing") );}?>