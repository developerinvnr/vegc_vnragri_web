<?phpinclude 'sidemenu.php';?><style type="text/css">	.pagethings{		position: absolute;		left: 200px;		padding: 20px;	}	.nshw{		display: none;	}	.ftable thead th,.ftable tbody th,.ftable tbody td{	  font-size: 12px !important;	  padding: 1px 2px !important;	  text-align: center;	  font-weight: 500;	  border:2px solid #ccc;	  margin:0px;	}	.ftable thead th{	  background-color:#e3f1f7;	  color: #000;	  font-size: 13px;	  font-weight: bold;	  padding: 7px 3px !important;	}	.ftable tbody td{	  background-color: #fff !important;	}	.dtinp{		padding: 4px;		border-radius: 5px;		border:1px solid #c1c1c1;		width: 90px;		text-align: center;	}</style><?php$allo=mysql_query("SELECT * FROM `organiser` o inner join user_location l on l.state_id=o.state_id where l.uid=".$_SESSION['uId']." AND l.sts='A'");while($allod=mysql_fetch_assoc($allo)){	$oarr[$allod['oid']]=$allod['oname'];}$allc=mysql_query("SELECT c.* FROM crop c, user_crop uc where c.cropid=uc.cropid and uc.uid='".$_SESSION['uId']."' order by c.cropname");while ($allcd=mysql_fetch_assoc($allc)) {	$crarr[$allcd['cropid']]=$allcd['cropname'];}$allf=mysql_query("SELECT f.* FROM farmers f, user_location ul WHERE f.state_id=ul.state_id and ul.uid='".$_SESSION['uId']."' and ul.sts='A'");while ($allfd=mysql_fetch_assoc($allf)) {	$farr[$allfd['fid']]=$allfd['fname'];}function gethierarchy($uid){	$id=array($uid);		if($_SESSION['uType']=='S'){		$sel=mysql_query("select uId from users where uStatus='A'");		while($seld = mysql_fetch_assoc($sel)){			$idc = array($seld['uId']);			$id = array_merge($id,$idc);		}	}else{		$sel=mysql_query("select uId from users where uStatus='A' AND uReporting='".$uid."'");		if(mysql_num_rows($sel) > 0){			while($seld = mysql_fetch_assoc($sel)){				$idc = array($seld['uId']);				$id = array_merge($id,$idc,gethierarchy($seld['uId']));			}		}	}	return $id;	}$allu=mysql_query("SELECT * FROM `users` where uStatus='A' AND uPost!=4 order by uName asc");while ($allud=mysql_fetch_assoc($allu)) {	$uarr[$allud['uId']]=strtoupper($allud['uName']);}?><div class="pagethings" style="width:85%;">		<div id="addcrtbl" style="margin-bottom:10px;padding:2px;background-color: #EDEDED;border:2px solid #ccc;overflow:scroll;">		<h6 style="font-weight: bold;">&nbsp;Export-Import:</h6>		<table class="ftable" style="margin-bottom:2px;">			<thead>				<tr><?php $sSe=mysql_query("select * from view_season where SesId=1"); $rSe=mysql_fetch_assoc($sSe);$sVd=mysql_query("select * from app_version where VersionId=1"); $rVd=mysql_fetch_assoc($sVd); $Kdf=date("d-m-Y",strtotime($rVd['Kharif_From'])); $Kdt=date("d-m-Y",strtotime($rVd['Kharif_To']));$Rdf=date("d-m-Y",strtotime($rVd['Rabi_From']));$Rdt=date("d-m-Y",strtotime($rVd['Rabi_To']));$Sdf=date("d-m-Y",strtotime($rVd['Summer_From']));$Sdt=date("d-m-Y",strtotime($rVd['Summer_To']));//if($rSe['Kharif']=='Y'){ $Df=$Kdf; $Dt=$Kdt; }//elseif($rSe['Rabi']=='Y'){ $Df=$Rdf; $Dt=$Rdt; }//elseif($rSe['Summer']=='Y'){ $Df=$Sdf; $Dt=$Sdt; }$cD=date("Y-m-d");if($cD>=$rVd['Kharif_From'] && $cD<=$rVd['Kharif_To']){ $Df=$Kdf; $Dt=$Kdt; }elseif($cD>=$rVd['Rabi_From'] && $cD<=$rVd['Rabi_To']){ $Df=$Rdf; $Dt=$Rdt; }elseif($cD>=$rVd['Summer_From'] && $cD<=$rVd['Summer_To']){ $Df=$Sdf; $Dt=$Sdt; }?><input type="hidden" id="Kdf" value="<?=$Kdf?>" /><input type="hidden" id="Kdt" value="<?=$Kdt?>" /><input type="hidden" id="Rdf" value="<?=$Rdf?>" /><input type="hidden" id="Rdt" value="<?=$Rdt?>" /><input type="hidden" id="Sdf" value="<?=$Sdf?>" /><input type="hidden" id="Sdt" value="<?=$Sdt?>" />									<th>&nbsp;Season:<br><select style="padding: 4px;border-radius: 4px;cursor:pointer;" onchange="setseason(this.value)"><option value="">Select Season</option>					    <option value="kharif" <?php if($cD>=$rVd['Kharif_From'] && $cD<=$rVd['Kharif_To']){echo 'selected';} ?>>Kharif</option>											<option value="rabi" <?php if($cD>=$rVd['Rabi_From'] && $cD<=$rVd['Rabi_To']){echo 'selected';} ?>>Rabi</option>										<option value="summer" <?php if($cD>=$rVd['Summer_From'] && $cD<=$rVd['Summer_To']){echo 'selected';} ?>>Summer</option>						</select>  										<!--&nbsp;Season:<br> 				    	<label id="klabel" for="kharif" style="padding: 4px;border-radius: 4px;cursor:pointer;"><input type="radio" name="season" value="kharif" id="kharif" onclick="setseason('kharif')"> Kharif </label>				    	&nbsp;&nbsp;				    	<label id="rlabel" for="rabi"  style="padding: 4px;border-radius: 4px;cursor:pointer;"><input type="radio" name="season" value="rabi" id="rabi" onclick="setseason('rabi')"> Rabi </label>-->				    	<script type="text/javascript">							function setseason(se){				    			var curdate = $('#from').val();				    			var curyear = curdate.split("-");				    			curyear = curyear[2];				    			var nextyear = parseInt(curyear)+1;				    			if(se=='kharif'){				    				$('#from').val($('#Kdf').val());				    				$('#to').val($('#Kdt').val());				    			}else if(se == 'rabi'){				    				$('#from').val($('#Rdf').val());				    				$('#to').val($('#Rdt').val());				    			}				    										   else if(se == 'summer'){				    				$('#from').val($('#Sdf').val());				    				$('#to').val($('#Sdt').val());				    								    			}				    		}				    	</script>				    </th>					<th>&nbsp;From: <input type="" class="dtinp" id="from" value="<?=$Df;?>" autocomplete="off"><br /><br />					    &nbsp;To:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="" class="dtinp" id="to" value="<?=$Dt;?>" autocomplete="off">					</th>															<th>						Crop: 						<select id="crop"  style="width: 130px;">							<option value="">All</option>							<?php foreach ($crarr as $key => $value) { ?>							<option value="<?=$key?>" ><?=$value?></option>							<?php } ?>						</select>					</th>					<!-- 						==========================================================================================						here farmer filter and organiser filter displayed because user asked to removed 						===========================================================================================					-->					<th style="display: none;">						Farmer: 						<select id="secondparty"  style="width: 140px;">							<option  value="">Select</option>							<?php foreach ($farr as $key => $value) { ?>							<option value="<?=$key?>"  ><?=$value?></option>							<?php } ?>						</select>					</th>					<th style="display: none;">						Organiser: 						<select id="orgr"  style="width: 140px;">							<option value="">Select</option>							<?php foreach ($oarr as $key => $value) { ?>							<option value="<?=$key?>" ><?=$value?></option>							<?php } ?>						</select>					</th>					<th>						<?php						$usr = array_unique(gethierarchy($_SESSION['uId'])) ;						// print_r($usr);						?>						Users: 						<select id="users"  style="width: 140px;">							<option value="">All</option>							<?php foreach ($uarr as $key => $value) { ?>							<option value="<?=$key?>"><?=$value?></option>							<?php } ?>						</select>					</th>														<th>						<button class="btn btn-sm btn-primary frmbtn" onclick="agreeSearch()">Search</button>					</th>					<th style="width: 80px;">						<a href="javascript:void(0)" onclick="exportagrixls()" style="font-size: 11px;"><u>Export<br/>In<br/>XLS</u></a>						<script type="text/javascript">							function exportagrixls(){								var from = $('#from').val();								var to = $('#to').val();								var crop = $('#crop').val();								var secondparty = $('#secondparty').val(); 									var orgr = $('#orgr').val();								var users = $('#users').val();								myWindow = window.open('exportagri.php?from='+from+'&to='+to+'&crop='+crop+'&secondparty='+secondparty+'&orgr='+orgr, '_blank', 'location=yes,height=300,width=400,scrollbars=yes,status=yes');								/*setTimeout(function(){ 									myWindow.close();								},1000);*/							}						</script>					</th>					<th style="width:120px;"> 						<a href="javascript:void(0)" onclick="exportagricsv()" style="font-size: 11px;"><u>Export In CSV</u></a><br><br><b><font style="color:#FF0000;">Use this file for <br /> Lotgen</font></b>						<script type="text/javascript">							function exportagricsv(){								var from = $('#from').val();								var to = $('#to').val();								var crop = $('#crop').val();								var secondparty = $('#secondparty').val(); 									var orgr = $('#orgr').val();								var users = $('#users').val();								myWindow = window.open('exportagriincsv.php?from='+from+'&to='+to+'&crop='+crop+'&secondparty='+secondparty+'&orgr='+orgr+'&users='+users, '_blank', 'location=yes,height=300,width=400,scrollbars=yes,status=yes');								/*setTimeout(function(){ 									myWindow.close();								},1000);*/							}						</script>					</th>                   					<th style="width:140px;">						<a href="javascript:void(0)" onclick="importagri()" style="font-size: 11px;"><u>Import In CSV</u></a>						<br><br><b><font style="color:#FF0000;">Use this for Import <br /> Lot No.</font></b>						<script type="text/javascript">							function importagri(){								var from = $('#from').val();								var to = $('#to').val();								var crop = $('#crop').val();								var secondparty = $('#secondparty').val(); 									var orgr = $('#orgr').val();								myWindow = window.open('importagri.php', '_blank', 'location=yes,height=350,width=700,scrollbars=yes,status=yes');								/*setTimeout(function(){ 									// myWindow.close();								},1000); */							}						</script>					</th>                    				</tr>			</thead>		</table>				<table id="" class=" estable table table-bordered" style="width:100%;">			<thead>			    <tr>					<th rowspan="2" style="width:40px;">S.No</th>					<th rowspan="2" style="width:80px;">Agreement<br />ID</th>					<th rowspan="2" style="width:80px;">Agreement<br />Date</th>					<th rowspan="2" style="width:60px;">Crop</th>					<th rowspan="2" style="width:90px;">FSCode<br />Female / Male</th>					<th rowspan="2" style="width:100px;">Organiser<br />Name</th>					<th rowspan="2" style="width:100px;">Farmer Name</th>					<th rowspan="2" style="width:100px;">Father Name</th>					<!--<th rowspan="2" style="width:100px;">Production<br />Person</th>-->					<!--<th>Farmer Id</th>-->															<th colspan="2">Farmer Address</th>					<th colspan="2">Production Location</th>					<th rowspan="2" style="width:50px;">Sow<br />Acre</th>					<th rowspan="2" style="width:50px;">Stand Acre<br />(GPS Measure)</th>				</tr> 				<tr>					<th style="width:90px;">Village-Tahsil</th>					<th style="width:90px;">District-State</th>					<th style="width:90px;">Village-Tahsil</th>					<th style="width:90px;">District-State</th>				</tr>			</thead>			<tbody id="reportBody">							</tbody>		</table>	</div>		<!--S. No.	Date 	Crop	Agreement No	Production Location	District	State	Organiser	Production Personnel	Farmer	Father	Plot No	Standing Acre	SP Code Female	SP Code Male-->	</div><script>	$('#from').datepicker({		format:'dd-mm-yyyy',		minDate: '10-10-2019',	});	$('#to').datepicker({format:'dd-mm-yyyy',});	function agreeSearch(page){		var crop = $('#crop').val(); 			if(crop==''){ alert("Please select crop!"); return false; }		var secondparty = $('#secondparty').val(); 			var orgr = $('#orgr').val();		var from = $('#from').val();		var to = $('#to').val();		var users = $('#users').val();				$.post("exportimportAjax.php",{ act:'get_report',page:page,crop:crop,orgr:orgr,from:from,to:to,secondparty:secondparty,users:users},function(data) {			console.log(data);			$('#reportBody').html(data);			// console.log(data);				    });	}	function pad2(number) {	    return (number < 10 ? '0' : '') + number;	}	$(document).ready(function(){		/* 		==========================================================================================================			below code is for setting and showing "from date" and "to date" to last 7 days to today and showing			last 7days result by default page load		=============================================================================================================		*/		var from = $('#from').val();		var to = $('#to').val();		if(from=='' && to==''){			var d = new Date();			var week = new Date();			week.setDate(d.getDate()-1);			var dd = d.getDate();			var dm = d.getMonth()+1;			var dy = d.getFullYear();			d = pad2(dd) + '-' + pad2(dm) + '-' + dy;			$('#to').val(d);			var wd = week.getDate();			var wm = week.getMonth()+1;			var wy = week.getFullYear();			week = pad2(wd) + '-' + pad2(wm) + '-' + wy;			$('#from').val(week);			$.post("exportimportAjax.php",{ act:'get_report',from:week,to:d},function(data) {				$('#reportBody').html(data);				console.log(data);						    });		}			});		</script>